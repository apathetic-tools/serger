# Cursor AI Rules for Serger Project

## Project Overview
Serger is a Python module stitcher that combines multiple source files into a single executable script.

## Key Conventions

### Code Quality
- **Line length**: Maximum 88 characters (enforced by Ruff)
- **Python version**: Target Python 3.10+ compatibility
- **Type checking**: Strict Pyright/Pylance + Mypy compliance required
- **Linting**: All code must pass `poetry run poe check:fix`
- **CI Requirements**: All linting and type checking errors must be resolved (CI fails otherwise). Either fix the error or add an appropriate ignore comment.

### Type Checking and Linting Best Practices

#### Ignore Comments
- **Placement**: Warning/error ignore comments go at the end of lines and don't count towards line length limits
- **Examples**: `# type: ignore[error-code]`, `# pyright: ignore[error-code]`, `# noqa: CODE`

#### Defensive Runtime Checks
- If using `isinstance` as a defensive runtime check, even if the type checker knows it's safe, add an ignore comment and keep the check if it provides reasonable safety (not overzealous)
- Example: `if isinstance(value, str):  # pyright: ignore[reportUnnecessaryIsInstance]`

#### Complexity Warnings
- Complexity warnings (PLR0915, C901, PLR0912) should prompt consideration of extracting helpers or splitting functions
- **Only do this if it improves readability**
- Some functions are inherently complex and aren't worth splitting up, or don't have a logical way to split them
- If splitting doesn't improve readability, add an ignore comment instead

#### Parameter and Return Value Warnings
- Warnings about too many parameters or return values (PLR0913, PLR0911) should prompt consideration of using a dataclass
- **Only do this if it makes sense and greatly improves readability**
- If a dataclass doesn't improve readability, add an ignore comment instead

#### Type Inference
- Use `cast_hint()` (from `utils`) or `cast()` to resolve type inference problems when possible, rather than using ignore comments
- Mypy can often infer types better than pyright
- If fixing a type makes mypy say it isn't required, fix the type and add a mypy ignore comment: `# type: ignore[unused-ignore]`

### Execution
- Always use `poetry run python3` (not bare `python3`) to ensure execution in the project's virtual environment
- Use `poetry run poe` tasks for all common operations (see pyproject.toml)

### Important Files
- `dist/serger.py` is **generated** - never edit directly
- Generate it using `poetry run poe build:script`
- `dist/` contains build outputs - do not edit

### Project Structure
- `src/serger/` - Main source code
- `tests/` - Test suite
- `dev/` - Development scripts

### Git Commit Conventions
- NEVER include AI tool attribution or Co-Authored-By trailers in commit messages
- Write clean, conventional commit messages

## Development Workflow
1. Make changes to source files in `src/serger/`
2. Run `poetry run poe check:fix` before committing
3. Run `poetry run poe build:script` to regenerate `dist/serger.py` if needed
4. Run `poetry run poe test` to verify changes

## See Also
- `.claude/CLAUDE.md` - Additional project context
- `pyproject.toml` - All tool configurations and poe tasks
- `ROADMAP.md` - Project roadmap and future plans


---
description: Execution and workflow conventions
globs:
  - "**/*.py"
alwaysApply: true
---

### Execution and Workflow
- Always use `poetry run python3` (not bare `python3`) to ensure execution in the project's virtual environment
- **Use poe tasks** for all common operations:
  - `poetry run poe check` - Run linting, type checking, and tests
  - `poetry run poe fix` - Auto-format and fix linting issues
  - `poetry run poe test` - Run test suite
  - `poetry run poe coverage` - Generate code coverage report (dual runtime coverage)
  - `poetry run poe check:fix` - Fix, type check, and test (run before committing)
  - `poetry run poe build:script` - Generate the single-file dist/serger.py
  - `poetry run poe sync:ai:guidance` - Sync AI guidance files from `.ai/` to `.cursor/` and `.claude/`
- **NEVER edit `.cursor/` or `.claude/` files directly**: These directories are generated from `.ai/` source files. Always edit files in `.ai/rules/` or `.ai/commands/` instead, then run `poetry run poe sync:ai:guidance` to sync changes.
- **When modifying `.ai/` files**: After changing any file in `.ai/rules/` or `.ai/commands/`, you **must**:
  1. Run `poetry run poe sync:ai:guidance` to sync changes to `.cursor/` and `.claude/`
  2. Include the generated files (`.cursor/rules/*.mdc`, `.cursor/commands/*.md`, `.claude/CLAUDE.md`) as part of the same changeset/commit
- **Before committing**: Run `poetry run poe check:fix` (this also regenerates `dist/serger.py` as needed)
- **Debugging failing tests**: Set `LOG_LEVEL=test` to output TRACE and DEBUG logs in failing tests, bypassing pytest's log capture. This is useful for debugging test failures:
  ```bash
  LOG_LEVEL=test poetry run poe test:pytest:installed tests/path/to/test.py::test_name -xvs
  ```
  The `test` log level is the most verbose and bypasses pytest's log capture, allowing you to see all TRACE and DEBUG logs even when tests fail.

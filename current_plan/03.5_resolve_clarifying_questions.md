# Iteration 03.5: Resolve Clarifying Questions

> **Context**: See `current_plan/00_overview.md` for overall strategy and principles.

## Goal
Resolve clarifying questions that should have been asked in previous iterations before proceeding with iteration 04. This ensures we have clear answers to design decisions that affect the implementation.

## Clarifying Questions

### Q1: When should default values be applied to module actions?

**Context**: The design doc mentions defaults for optional fields:
- `action`: default `"move"`
- `mode`: default `"preserve"`
- `scope`: default `"shim"` for user actions, `"original"` for mode-generated
- `affects`: default `"shims"`
- `cleanup`: default `"auto"`

**Question**: Should defaults be applied:
- **Option A**: At config resolution time (in `_validate_and_normalize_module_actions`) - all fields present in `BuildConfigResolved`
- **Option B**: Later when processing actions (in `module_actions.py`) - keep fields optional in `BuildConfigResolved`

**Decision needed**: [Your answer here]

**Rationale**: [Your reasoning here]

---

### Q2: Should `BuildConfigResolved.module_actions` have all fields present with defaults?

**Context**: `BuildConfigResolved` is a "Resolved" TypedDict, meaning it should have all fields present with final values.

**Question**: Should `BuildConfigResolved.module_actions` be:
- **Option A**: `list[ModuleActionFull]` where all fields are present (defaults applied) - fully resolved
- **Option B**: `list[ModuleActionFull]` where optional fields remain optional - defaults applied later

**Decision needed**: [Your answer here]

**Rationale**: [Your reasoning here]

---

### Q3: When should `scope` defaults be set?

**Context**: The design doc says:
- User actions default to `scope: "shim"`
- Mode-generated actions default to `scope: "original"`

**Question**: Should we:
- **Option A**: Set `scope: "shim"` for all user actions at config resolution time (even though we don't know if they're mode-generated yet)
- **Option B**: Keep `scope` optional and set defaults later when we know if actions are mode-generated or user-specified
- **Option C**: Set `scope: "shim"` for user actions at config resolution, and mode-generated actions will set `scope: "original"` when they're created

**Decision needed**: [Your answer here]

**Rationale**: [Your reasoning here]

---

### Q4: Should dict format actions have `scope: "shim"` set explicitly?

**Context**: The design doc says dict format defaults to `scope: "shim"` for user actions.

**Question**: When converting dict format to list format, should we:
- **Option A**: Explicitly set `scope: "shim"` in the normalized action
- **Option B**: Leave `scope` optional and set default later

**Decision needed**: [Your answer here]

**Rationale**: [Your reasoning here]

---

### Q5: When should `dest` validation happen?

**Context**: The design doc says:
- `dest` is required for `move`/`copy`
- `dest` must not be present for `delete`

**Question**: Should we validate this:
- **Option A**: In iteration 04 (config resolution) - validate upfront
- **Option B**: Later when processing actions (iteration 07+) - validate when needed

**Decision needed**: [Your answer here]

**Rationale**: [Your reasoning here]

---

### Q6: Is `source_path` needed in iteration 03/04?

**Context**: The design doc mentions `source_path` for re-including excluded modules (section 19).

**Question**: Should we:
- **Option A**: Include `source_path` validation in iteration 04 (even if not used yet)
- **Option B**: Defer `source_path` handling to later iteration when it's actually needed

**Decision needed**: [Your answer here]

**Rationale**: [Your reasoning here]

---

### Q7: What does `shim: "public"` mean and when should it be implemented?

**Context**: The design doc says `shim: "public"` means "Only generate shims for public modules (future: based on `_` prefix or `__all__`)".

**Question**: Should we:
- **Option A**: Implement `shim: "public"` now (even if basic implementation)
- **Option B**: Defer `shim: "public"` to later iteration
- **Option C**: Accept `"public"` as valid value but treat it same as `"all"` for now

**Decision needed**: [Your answer here]

**Rationale**: [Your reasoning here]

---

## Action Items

After answering all questions, update:
1. `current_plan/03_add_module_actions_types.md` - Add clarifications to the implementation
2. `current_plan/04_validate_module_actions_config.md` - Update based on decisions
3. Implementation code - Apply decisions consistently

## Testing
- No code changes in this iteration - just documentation and decision-making
- After decisions are made, update iteration 04 plan accordingly

## Notes
- This iteration is about clarifying design decisions, not implementing code
- All questions should be answered before proceeding to iteration 04
- Answers will guide the implementation approach

